schema: '2.0'
stages:
  download-satellite-data:
    cmd: papermill download_satellite_data.ipynb download_satellite_data.output.ipynb
      && rm download_satellite_data.output.ipynb
    deps:
    - path: download_satellite_data.ipynb
      hash: md5
      md5: 57b9ed6f3a8f68700ea9859cd8ae60a3
      size: 29416
    params:
      params.yaml:
        number_of_timesteps: 9
        paths.satellite: data/satellite
        search_dates: 2019-04-01T00:00:00.000Z/2019-09-01T00:00:00.000Z
        zueri_crop.bbox:
        - 8.364
        - 47.24
        - 9.0405
        - 47.69894
    outs:
    - path: data/satellite
      hash: md5
      md5: 6f63cafc153935977e3b3cb0fbe6020b.dir
      size: 2128221201
      nfiles: 174
  rasterize:
    cmd: papermill rasterize_labels.ipynb rasterize_labels.output.ipynb && rm rasterize_labels.output.ipynb
    deps:
    - path: data/TG_2019_Nutzungsflaechen_2019.gpkg
      hash: md5
      md5: e3f957fdda235db7f7ebebd44afdb77b
      size: 52637696
    - path: data/ZH_2019_LW_NUTZUNGSFLAECHEN_F.dbf
      hash: md5
      md5: 44cb1a911f2da61101f5a8a3f375b955
      size: 69359582
    - path: data/ZH_2019_LW_NUTZUNGSFLAECHEN_F.prj
      hash: md5
      md5: 313304cd209164f8f1694217325cad38
      size: 472
    - path: data/ZH_2019_LW_NUTZUNGSFLAECHEN_F.shp
      hash: md5
      md5: 899948e63250e6a0606d27d4a8c5218d
      size: 74599628
    - path: data/ZH_2019_LW_NUTZUNGSFLAECHEN_F.shx
      hash: md5
      md5: a2b42dbb531394feb196ebf81e551e73
      size: 817284
    - path: data/georef-switzerland-kanton@public.geojson
      hash: md5
      md5: c6ca8fd5486358688668668f44727240
      size: 3134206
    - path: data/labels_hierarchy.csv
      hash: md5
      md5: 6c5626388f82bf7734048a9e35d39bcf
      size: 5970
    - path: data/labels_hierarchy_seasonality.csv
      hash: md5
      md5: fa7c9990b7ebff3f392446fcb7a836e1
      size: 11241
    - path: data/labels_hierarchy_seasonality_reduced.csv
      hash: md5
      md5: 6b7eec240d94523ee41d761e910a9481
      size: 8657
    - path: data/satellite
      hash: md5
      md5: 6f63cafc153935977e3b3cb0fbe6020b.dir
      size: 2128221201
      nfiles: 174
    - path: rasterize_labels.ipynb
      hash: md5
      md5: 15aec22c5bdb373739e3382c6bb29d2d
      size: 5199951
    params:
      params.yaml:
        label_hierarchy_definition: zueri_crop
        max_cloud_cover: 5
        paths.dataset_info: data/dataset_info.json
        paths.field_ids: data/field_ids.tif
        paths.labels: data/labels.tif
        paths.labels_hierarchy: data/labels_hierarchy.tif
        paths.satellite: data/satellite
        zueri_crop.bbox:
        - 8.364
        - 47.24
        - 9.0405
        - 47.69894
    outs:
    - path: data/dataset_info.json
      hash: md5
      md5: 728e1e43820a6841bb4d9e80a523e1cf
      size: 2683
    - path: data/field_ids.tif
      hash: md5
      md5: a5b8ecd1cc3e9fa7b5cf885216f0ce73
      size: 104888680
    - path: data/labels.tif
      hash: md5
      md5: fcc5cc97d5c3cabf568c9ec053ff994f
      size: 26245480
    - path: data/labels_hierarchy.tif
      hash: md5
      md5: 65ebb2ac0667f3998f1f90e4fdbaddc7
      size: 78674292
  prepare-dataset:
    cmd: papermill prepare_dataset.ipynb prepare_dataset.output.ipynb && rm prepare_dataset.output.ipynb
    deps:
    - path: data/field_ids.tif
      hash: md5
      md5: a5b8ecd1cc3e9fa7b5cf885216f0ce73
      size: 104888680
    - path: data/labels_hierarchy.tif
      hash: md5
      md5: 65ebb2ac0667f3998f1f90e4fdbaddc7
      size: 78674292
    - path: data/satellite
      hash: md5
      md5: 6f63cafc153935977e3b3cb0fbe6020b.dir
      size: 2128221201
      nfiles: 174
    - path: prepare_dataset.ipynb
      hash: md5
      md5: 33d60b25102864451546e0274a79aa1a
      size: 5194515
    params:
      params.yaml:
        chip_size: 224
        distribution_transform_mode: None
        fold_split_mode: stratified
        number_of_folds: 6
        number_of_timesteps: 9
        paths.field_ids: data/field_ids.tif
        paths.labels: data/labels.tif
        paths.labels_hierarchy: data/labels_hierarchy.tif
        paths.satellite: data/satellite
    outs:
    - path: data/chips
      hash: md5
      md5: 502855d7390da53c9c9430690be889b8.dir
      size: 2477774442
      nfiles: 1287
    - path: data/stacked_features.tif
      hash: md5
      md5: 42b9311b73cbfc4c75b3ac2c276c56bd
      size: 2831196854
  calculate-dataset-stats:
    cmd: papermill calculate_dataset_stats.ipynb calculate_dataset_stats.output.ipynb
      && rm calculate_dataset_stats.output.ipynb
    deps:
    - path: calculate_dataset_stats.ipynb
      hash: md5
      md5: 18dacda57477bed094f9c708ff2db993
      size: 4765
    - path: data/chips
      hash: md5
      md5: 502855d7390da53c9c9430690be889b8.dir
      size: 2477774442
      nfiles: 1287
    - path: data/labels_hierarchy.tif
      hash: md5
      md5: 65ebb2ac0667f3998f1f90e4fdbaddc7
      size: 78674292
    params:
      params.yaml:
        number_of_bands: 6
        number_of_folds: 6
        number_of_timesteps: 9
        paths.chips: data/chips
        paths.labels_hierarchy: data/labels_hierarchy.tif
    outs:
    - path: data/chips_stats.yaml
      hash: md5
      md5: 327364ec0e7acfc48a8842a02953ee83
      size: 1831
  download-prithvi-base-model:
    cmd: papermill download_prithvi_100M.ipynb download_prithvi_100M.output.ipynb
      && rm download_prithvi_100M.output.ipynb
    deps:
    - path: download_prithvi_100M.ipynb
      hash: md5
      md5: 40b7a4b862a6257861f0fe8d67541e61
      size: 1016
    outs:
    - path: prithvi/models/Prithvi_100M.pt
      hash: md5
      md5: 87d9bd8bea755cdc1412be17970fd285
      size: 453672901
